<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>TGLFS</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
        <link href="./style.css" rel="stylesheet" />
        <link rel="icon" href="./icons/TGLFS logo 192.png" sizes="192x192" type="image/png" />
        <link rel="manifest" href="./manifest.json" />
        <script type="module" src="web/app.ts"></script>
    </head>
    <body class="text-center">
        <div id="app">
            <div id="logo">üóÇÔ∏è</div>
            <h1 id="title" class="h3 mb-3 font-weight-normal">Telegram Large File Storage</h1>
            <div id="splash">Loading...</div>
            <div id="login" hidden>
                <form id="loginForm" autocomplete="on" onsubmit="event.preventDefault();">
                    <input type="text" id="apiId" class="form-control" name="apiId" placeholder="API ID" />
                    <input type="text" id="apiHash" class="form-control" name="apiHash" placeholder="API Hash" />
                    <input type="tel" id="phone" class="form-control" name="phone" placeholder="Phone Number" />
                    <button id="loginButton" type="submit" class="btn btn-lg btn-primary btn-block w-100">Sign In</button>
                </form>
                <div class="mt-3">
                    <a href="https://my.telegram.org/apps" target="_blank" class="text-muted">Register for Telegram API</a>
                </div>
            </div>
            <div id="controls" class="button-group" hidden>
                <label id="uploadFileLabel" for="uploadFileInput" class="btn btn-lg btn-outline-primary btn-block w-100">
                    Upload
                </label>
                <input type="file" id="uploadFileInput" />
                <button id="fileLookupButton" class="btn btn-lg btn-outline-primary btn-block w-100 middleButton">
                    Search
                </button>
                <button id="sendFileButton" class="btn btn-lg btn-outline-primary btn-block w-100 middleButton">
                    Send
                </button>
                <button id="unsendFileButton" class="btn btn-lg btn-outline-primary btn-block w-100 middleButton">
                    Unsend
                </button>
                <button id="receiveFileButton" class="btn btn-lg btn-outline-primary btn-block w-100 middleButton">
                    Receive
                </button>
                <button id="renameFileButton" class="btn btn-lg btn-outline-primary btn-block w-100 middleButton">
                    Rename
                </button>
                <button id="deleteFileButton" class="btn btn-lg btn-outline-primary btn-block w-100 middleButton">
                    Delete
                </button>
                <button id="downloadFileButton" class="btn btn-lg btn-outline-primary btn-block w-100">
                    Download
                </button>
                <button id="downloadFileLegacyButton" class="btn btn-lg btn-outline-secondary btn-block w-100" style="margin-top: 8px;">
                    Download (Legacy)
                </button>
                <button id="fileBrowserButton" class="btn btn-lg btn-outline-primary btn-block w-100" style="margin-top: 8px;">
                    File Browser
                </button>
            </div>
            <div id="progressBarContainer" hidden>
                <div id="progressBarText"></div>
                <div id="progressBar" class="progress text-center">
                    <div id="progress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                </div>
                <div id="progressBytesText" class="text-muted">0 / 0 bytes</div>
                <div id="progressTimeText" class="text-muted">Elapsed: 00:00:00 ‚Ä¢ Remaining: --:--:--</div>
            </div>
            <div id="fileBrowser" hidden>
                <div class="fx-header">
                    <div class="d-flex gap-2 align-items-center mb-2">
                        <button id="browserHomeButton" class="btn btn-secondary">Home</button>
                        <button id="browserActionUpload" class="btn btn-primary">Upload</button>
                        <button id="browserActionReceive" class="btn btn-primary">Receive</button>
                        <div class="ms-auto d-flex gap-2 browser-actions">
                            <button id="browserActionDownload" class="btn btn-primary" disabled>Download</button>
                            <button id="browserActionRename" class="btn btn-secondary" disabled>Rename</button>
                            <button id="browserActionDelete" class="btn btn-danger" disabled>Delete</button>
                            <button id="browserActionSend" class="btn btn-primary" disabled>Send</button>
                            <button id="browserActionUnsend" class="btn btn-danger">Unsend</button>
                        </div>
                        <div class="ms-2 dropdown browser-actions-dropdown">
                            <button id="browserActionsBtn" class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                                Actions
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" id="actionDownloadItem">Download</a></li>
                                <li><a class="dropdown-item" href="#" id="actionRenameItem">Rename</a></li>
                                <li><a class="dropdown-item text-danger" href="#" id="actionDeleteItem">Delete</a></li>
                                <li><hr class="dropdown-divider" /></li>
                                <li><a class="dropdown-item" href="#" id="actionSendItem">Send</a></li>
                                <li><a class="dropdown-item text-danger" href="#" id="actionUnsendItem">Unsend</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="d-flex gap-2 align-items-center">
                        <label for="browserSortSelect" class="form-label m-0">Sort by</label>
                        <select id="browserSortSelect" class="form-select" style="max-width: 180px;">
                            <option value="date_desc">Date (newest)</option>
                            <option value="date_asc">Date (oldest)</option>
                            <option value="name_asc">Name (A‚ÄìZ)</option>
                            <option value="name_desc">Name (Z‚ÄìA)</option>
                            <option value="size_desc">Size (largest)</option>
                            <option value="size_asc">Size (smallest)</option>
                        </select>
                        <input id="browserSearchInput" class="form-control ms-auto" style="max-width: 480px;" placeholder="Search name or UFID" />
                    </div>
                </div>
                <div id="browserContent" class="browser-content">
                    <div class="table-responsive">
                        
                        <table id="browserTable" class="table table-hover align-middle fade-in">
                            <thead>
                                <tr>
                                    <th class="name">Name</th>
                                    <th class="size">Size</th>
                                    <th class="ufid">UFID</th>
                                    <th class="date">Date</th>
                                    <th class="status">Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div id="browserCards" class="fade-in d-lg-none"></div>
                    <div class="d-flex justify-content-between" style="margin-top: 8px;">
                        <button id="browserPrevPage" class="btn btn-secondary">Previous</button>
                        <div id="browserPageInfo" class="text-muted"></div>
                        <button id="browserNextPage" class="btn btn-secondary">Next</button>
                    </div>
                </div>
            </div>
            <div id="donation" class="text-muted" style="margin-top: 64px">
                Support development! XMR donation address:<br /><code style="word-wrap: break-word; user-select: text"
                    >44Y1jFtwoDrHuYPnrmxdDw55qdsvahUhRbNC8BcTu1E5MMXZ1xkeVXsKWHRd5Z5DJUeEvX87CUycE3Xg38LwG6YvSzLLyoL</code
                >
            </div>
        </div>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
        ></script>
        <script type="module">
            if (typeof navigator.serviceWorker !== "undefined") {
                navigator.serviceWorker.register(new URL("/src/offline-page-sw.js", import.meta.url))
                    .catch(err => {
                        console.error("Failed to register service worker: ", err)
                    })
            }
        </script>
    </body>
</html>